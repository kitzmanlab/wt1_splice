#!/usr/bin/env bash

#grabs bcs and displays reads in IGV for subassembly

#usage: /nfs/kitzman2/smithcat/proj/wt1_2022/scripts/extract_read_groups_rna.sh PATH_TO_RNA_BAM PATH_TO_RNA_BAM_BARCODE_INDEX PATH_TO_BC_TBL_TXT PATH_TO_WEB_OUTPUT_DIR REF_FASTA_PATH

#make sure you are in your subasm_py2 environment!

#2022-0421 
#/nfs/kitzman2/smithcat/proj/wt1_2022/scripts/extract_read_groups_rna.sh /nfs/kitzman2/jacob/proj/jensplice/20220415_wt1_mpsa_trial3/process_star/BB_test_Cos1053_oligodT_MM2B/BB_test_Cos1053_oligodT_MM2BAligned.out.wbcs.bam /nfs/kitzman2/jacob/proj/jensplice/20220415_wt1_mpsa_trial3/process_star/BB_test_Cos1053_oligodT_MM2B/BB_test_Cos1053_oligodT_MM2BAligned.out.wbcs.ix.txt /nfs/kitzman2/smithcat/proj/wt1_2022/20220421_inspect_bcs/rand_20_bcs.txt /srv/www/html/pub/public/kitzmanlab/202204_cathy_temp/20220421_wt1_inspection/rand_20_bcs/JKP1053_MM2B_oligoDT/ /nfs/kitzman2/jacob/proj/jensplice/20220415_wt1_mpsa_trial3/jkp1053_1054_1055.fa

#2022-0425
#/nfs/kitzman2/smithcat/proj/wt1_2022/scripts/extract_read_groups_rna.sh /nfs/kitzman2/jacob/proj/jensplice/20220415_wt1_mpsa_trial3/process_star/BB_test_Cos1053_oligodT_MM1B/BB_test_Cos1053_oligodT_MM1BAligned.out.wbcs.bam /nfs/kitzman2/jacob/proj/jensplice/20220415_wt1_mpsa_trial3/process_star/BB_test_Cos1053_oligodT_MM1B/BB_test_Cos1053_oligodT_MM1BAligned.out.wbcs.ix.txt /nfs/kitzman2/smithcat/proj/wt1_2022/20220421_inspect_bcs/rand_20_bcs.txt /srv/www/html/pub/public/kitzmanlab/202204_cathy_temp/20220421_wt1_inspection/rand_20_bcs/JKP1053_MM1B_oligoDT/ /nfs/kitzman2/jacob/proj/jensplice/20220415_wt1_mpsa_trial3/jkp1053_1054_1055.fa
#/nfs/kitzman2/smithcat/proj/wt1_2022/scripts/extract_read_groups_rna.sh /nfs/kitzman2/jacob/proj/jensplice/20220415_wt1_mpsa_trial3/process_star/BB_test_Cos1053_JKLab0340_MM1B/BB_test_Cos1053_JKLab0340_MM1BAligned.out.wbcs.bam /nfs/kitzman2/jacob/proj/jensplice/20220415_wt1_mpsa_trial3/process_star/BB_test_Cos1053_JKLab0340_MM1B/BB_test_Cos1053_JKLab0340_MM1BAligned.out.wbcs.ix.txt /nfs/kitzman2/smithcat/proj/wt1_2022/20220421_inspect_bcs/rand_20_bcs.txt /srv/www/html/pub/public/kitzmanlab/202204_cathy_temp/20220421_wt1_inspection/rand_20_bcs/JKP1053_MM1B/ /nfs/kitzman2/jacob/proj/jensplice/20220415_wt1_mpsa_trial3/jkp1053_1054_1055.fa
#/nfs/kitzman2/smithcat/proj/wt1_2022/scripts/extract_read_groups_rna.sh /nfs/kitzman2/jacob/proj/jensplice/20220415_wt1_mpsa_trial3/process_star/BB_test_Cos1053_JKLab0340_MM2B/BB_test_Cos1053_JKLab0340_MM2BAligned.out.wbcs.bam /nfs/kitzman2/jacob/proj/jensplice/20220415_wt1_mpsa_trial3/process_star/BB_test_Cos1053_JKLab0340_MM2B/BB_test_Cos1053_JKLab0340_MM2BAligned.out.wbcs.ix.txt /nfs/kitzman2/smithcat/proj/wt1_2022/20220421_inspect_bcs/rand_20_bcs.txt /srv/www/html/pub/public/kitzmanlab/202204_cathy_temp/20220421_wt1_inspection/rand_20_bcs/JKP1053_MM2B/ /nfs/kitzman2/jacob/proj/jensplice/20220415_wt1_mpsa_trial3/jkp1053_1054_1055.fa

#2022-0427 
#/nfs/kitzman2/smithcat/proj/wt1_2022/scripts/extract_read_groups_rna.sh /nfs/kitzman2/jacob/proj/jensplice/20220415_wt1_mpsa_trial3/process_star/BB_test_Cos1053_oligodT_MM2B/BB_test_Cos1053_oligodT_MM2BAligned.out.wbcs.bam /nfs/kitzman2/jacob/proj/jensplice/20220415_wt1_mpsa_trial3/process_star/BB_test_Cos1053_oligodT_MM2B/BB_test_Cos1053_oligodT_MM2BAligned.out.wbcs.ix.txt /nfs/kitzman2/smithcat/proj/wt1_2022/20220421_inspect_bcs/rand_40_pass_bcs.txt /srv/www/html/pub/public/kitzmanlab/202204_cathy_temp/20220421_wt1_inspection/rand_40_pass_bcs/JKP1053_MM2B_oligoDT/ /nfs/kitzman2/jacob/proj/jensplice/20220415_wt1_mpsa_trial3/jkp1053_1054_1055.fa
#/nfs/kitzman2/smithcat/proj/wt1_2022/scripts/extract_read_groups_rna.sh /nfs/kitzman2/jacob/proj/jensplice/20220415_wt1_mpsa_trial3/process_star/BB_test_Cos1053_oligodT_MM1B/BB_test_Cos1053_oligodT_MM1BAligned.out.wbcs.bam /nfs/kitzman2/jacob/proj/jensplice/20220415_wt1_mpsa_trial3/process_star/BB_test_Cos1053_oligodT_MM1B/BB_test_Cos1053_oligodT_MM1BAligned.out.wbcs.ix.txt /nfs/kitzman2/smithcat/proj/wt1_2022/20220421_inspect_bcs/rand_40_pass_bcs.txt /srv/www/html/pub/public/kitzmanlab/202204_cathy_temp/20220421_wt1_inspection/rand_40_pass_bcs/JKP1053_MM1B_oligoDT/ /nfs/kitzman2/jacob/proj/jensplice/20220415_wt1_mpsa_trial3/jkp1053_1054_1055.fa
#/nfs/kitzman2/smithcat/proj/wt1_2022/scripts/extract_read_groups_rna.sh /nfs/kitzman2/jacob/proj/jensplice/20220415_wt1_mpsa_trial3/process_star/BB_test_Cos1053_JKLab0340_MM1B/BB_test_Cos1053_JKLab0340_MM1BAligned.out.wbcs.bam /nfs/kitzman2/jacob/proj/jensplice/20220415_wt1_mpsa_trial3/process_star/BB_test_Cos1053_JKLab0340_MM1B/BB_test_Cos1053_JKLab0340_MM1BAligned.out.wbcs.ix.txt /nfs/kitzman2/smithcat/proj/wt1_2022/20220421_inspect_bcs/rand_40_pass_bcs.txt /srv/www/html/pub/public/kitzmanlab/202204_cathy_temp/20220421_wt1_inspection/rand_40_pass_bcs/JKP1053_MM1B/ /nfs/kitzman2/jacob/proj/jensplice/20220415_wt1_mpsa_trial3/jkp1053_1054_1055.fa
#/nfs/kitzman2/smithcat/proj/wt1_2022/scripts/extract_read_groups_rna.sh /nfs/kitzman2/jacob/proj/jensplice/20220415_wt1_mpsa_trial3/process_star/BB_test_Cos1053_JKLab0340_MM2B/BB_test_Cos1053_JKLab0340_MM2BAligned.out.wbcs.bam /nfs/kitzman2/jacob/proj/jensplice/20220415_wt1_mpsa_trial3/process_star/BB_test_Cos1053_JKLab0340_MM2B/BB_test_Cos1053_JKLab0340_MM2BAligned.out.wbcs.ix.txt /nfs/kitzman2/smithcat/proj/wt1_2022/20220421_inspect_bcs/rand_40_pass_bcs.txt /srv/www/html/pub/public/kitzmanlab/202204_cathy_temp/20220421_wt1_inspection/rand_40_pass_bcs/JKP1053_MM2B/ /nfs/kitzman2/jacob/proj/jensplice/20220415_wt1_mpsa_trial3/jkp1053_1054_1055.fa

#2022-0505
#/nfs/kitzman2/smithcat/proj/wt1_2022/scripts/extract_read_groups_rna.sh /nfs/kitzman2/jacob/proj/jensplice/20220422_wt1_mpsa_trial4and3_deep/process_star/BB_RT_1_340_335_Cos1053/BB_RT_1_340_335_Cos1053Aligned.out.wbcs.bam /nfs/kitzman2/jacob/proj/jensplice/20220422_wt1_mpsa_trial4and3_deep/process_star/BB_RT_1_340_335_Cos1053/BB_RT_1_340_335_Cos1053Aligned.out.wbcs.ix.txt /nfs/kitzman2/smithcat/proj/wt1_2022/20220505_inspect_bad_vars/JKP1053_BB_RT_1_340_335_Cos1053_bad_vars.txt /srv/www/html/pub/public/kitzmanlab/202204_cathy_temp/20220505_bad_vars/BB_RT_1_340_335_Cos1053/ /nfs/kitzman2/jacob/proj/jensplice/20220415_wt1_mpsa_trial3/jkp1053_1054_1055.fa
#/nfs/kitzman2/smithcat/proj/wt1_2022/scripts/extract_read_groups_rna.sh /nfs/kitzman2/jacob/proj/jensplice/20220422_wt1_mpsa_trial4and3_deep/process_star/BB_RT_1_ODT_243_Cos1053/BB_RT_1_ODT_243_Cos1053Aligned.out.wbcs.bam //nfs/kitzman2/jacob/proj/jensplice/20220422_wt1_mpsa_trial4and3_deep/process_star/BB_RT_1_ODT_243_Cos1053/BB_RT_1_ODT_243_Cos1053Aligned.out.wbcs.ix.txt /nfs/kitzman2/smithcat/proj/wt1_2022/20220505_inspect_bad_vars/JKP1053_BB_RT_1_ODT_243_Cos1053_bad_vars.txt /srv/www/html/pub/public/kitzmanlab/202204_cathy_temp/20220505_bad_vars/BB_RT_1_ODT_243_Cos1053/ /nfs/kitzman2/jacob/proj/jensplice/20220415_wt1_mpsa_trial3/jkp1053_1054_1055.fa
#/nfs/kitzman2/smithcat/proj/wt1_2022/scripts/extract_read_groups_rna.sh /nfs/kitzman2/jacob/proj/jensplice/20220422_wt1_mpsa_trial4and3_deep/process_star/BB_test_Cos1053_oligodT_MM1B/BB_test_Cos1053_oligodT_MM1BAligned.out.wbcs.bam /nfs/kitzman2/jacob/proj/jensplice/20220422_wt1_mpsa_trial4and3_deep/process_star/BB_test_Cos1053_oligodT_MM1B/BB_test_Cos1053_oligodT_MM1BAligned.out.wbcs.ix.txt /nfs/kitzman2/smithcat/proj/wt1_2022/20220505_inspect_bad_vars/JKP1053_BB_test_Cos1053_oligodT_MM1B_bad_vars.txt /srv/www/html/pub/public/kitzmanlab/202204_cathy_temp/20220505_bad_vars/BB_test_Cos1053_oligodT_MM1B/ /nfs/kitzman2/jacob/proj/jensplice/20220415_wt1_mpsa_trial3/jkp1053_1054_1055.fa
#/nfs/kitzman2/smithcat/proj/wt1_2022/scripts/extract_read_groups_rna.sh /nfs/kitzman2/jacob/proj/jensplice/20220422_wt1_mpsa_trial4and3_deep/process_star/BB_RT_2_340_335_Cos1054/BB_RT_2_340_335_Cos1054Aligned.out.wbcs.bam /nfs/kitzman2/jacob/proj/jensplice/20220422_wt1_mpsa_trial4and3_deep/process_star/BB_RT_2_340_335_Cos1054/BB_RT_2_340_335_Cos1054Aligned.out.wbcs.ix.txt /nfs/kitzman2/smithcat/proj/wt1_2022/20220505_inspect_bad_vars/JKP1054_BB_RT_2_340_335_Cos1054_bad_vars.txt /srv/www/html/pub/public/kitzmanlab/202204_cathy_temp/20220505_bad_vars/BB_RT_2_340_335_Cos1054/ /nfs/kitzman2/jacob/proj/jensplice/20220415_wt1_mpsa_trial3/jkp1053_1054_1055.fa
#/nfs/kitzman2/smithcat/proj/wt1_2022/scripts/extract_read_groups_rna.sh /nfs/kitzman2/jacob/proj/jensplice/20220422_wt1_mpsa_trial4and3_deep/process_star/BB_RT_2_ODT_243_Cos1054/BB_RT_2_ODT_243_Cos1054Aligned.out.wbcs.bam /nfs/kitzman2/jacob/proj/jensplice/20220422_wt1_mpsa_trial4and3_deep/process_star/BB_RT_2_ODT_243_Cos1054/BB_RT_2_ODT_243_Cos1054Aligned.out.wbcs.ix.txt /nfs/kitzman2/smithcat/proj/wt1_2022/20220505_inspect_bad_vars/JKP1054_BB_RT_2_ODT_243_Cos1054_bad_vars.txt /srv/www/html/pub/public/kitzmanlab/202204_cathy_temp/20220505_bad_vars/BB_RT_2_ODT_243_Cos1054/ /nfs/kitzman2/jacob/proj/jensplice/20220415_wt1_mpsa_trial3/jkp1053_1054_1055.fa
#/nfs/kitzman2/smithcat/proj/wt1_2022/scripts/extract_read_groups_rna.sh /nfs/kitzman2/jacob/proj/jensplice/20220422_wt1_mpsa_trial4and3_deep/process_star/BB_RT_3_ODT_335_cos1055/BB_RT_3_ODT_335_cos1055Aligned.out.wbcs.bam /nfs/kitzman2/jacob/proj/jensplice/20220422_wt1_mpsa_trial4and3_deep/process_star/BB_RT_3_ODT_335_cos1055/BB_RT_3_ODT_335_cos1055Aligned.out.wbcs.ix.txt /nfs/kitzman2/smithcat/proj/wt1_2022/20220505_inspect_bad_vars/JKP1055_BB_RT_3_ODT_335_cos1055_bad_vars.txt /srv/www/html/pub/public/kitzmanlab/202204_cathy_temp/20220505_bad_vars/BB_RT_3_ODT_335_cos1055/ /nfs/kitzman2/jacob/proj/jensplice/20220415_wt1_mpsa_trial3/jkp1053_1054_1055.fa

#2022-0512
#/nfs/kitzman2/smithcat/proj/wt1_2022/scripts/extract_read_groups_rna.sh /nfs/kitzman2/jacob/proj/jensplice/20220422_wt1_mpsa_trial4and3_deep/process_star/BB_RT_1_340_243_Hek1053/BB_RT_1_340_243_Hek1053Aligned.out.wbcs.bam /nfs/kitzman2/jacob/proj/jensplice/20220422_wt1_mpsa_trial4and3_deep/process_star/BB_RT_1_340_243_Hek1053/BB_RT_1_340_243_Hek1053Aligned.out.wbcs.ix.txt /nfs/kitzman2/smithcat/proj/wt1_2022/20220512_accept_vars/JKP1053_BB_RT_1_340_243_Hek1053_acceptor_vars.txt /srv/www/html/pub/public/kitzmanlab/202204_cathy_temp/20220512_accept_vars/BB_RT_1_340_243_Hek1053/ /nfs/kitzman2/jacob/proj/jensplice/20220415_wt1_mpsa_trial3/jkp1053_1054_1055.fa
#/nfs/kitzman2/smithcat/proj/wt1_2022/scripts/extract_read_groups_rna.sh /nfs/kitzman2/jacob/proj/jensplice/20220422_wt1_mpsa_trial4and3_deep/process_star/BB_RT_1_ODT_243_Hek1053/BB_RT_1_ODT_243_Hek1053Aligned.out.wbcs.bam /nfs/kitzman2/jacob/proj/jensplice/20220422_wt1_mpsa_trial4and3_deep/process_star/BB_RT_1_ODT_243_Hek1053/BB_RT_1_ODT_243_Hek1053Aligned.out.wbcs.ix.txt /nfs/kitzman2/smithcat/proj/wt1_2022/20220512_accept_vars/JKP1053_BB_RT_1_ODT_243_Hek1053_acceptor_vars.txt /srv/www/html/pub/public/kitzmanlab/202204_cathy_temp/20220512_accept_vars/BB_RT_1_ODT_243_Hek1053/ /nfs/kitzman2/jacob/proj/jensplice/20220415_wt1_mpsa_trial3/jkp1053_1054_1055.fa
#/nfs/kitzman2/smithcat/proj/wt1_2022/scripts/extract_read_groups_rna.sh /nfs/kitzman2/jacob/proj/jensplice/20220422_wt1_mpsa_trial4and3_deep/process_star/BB_RT_1_340_335_Cos1053/BB_RT_1_340_335_Cos1053Aligned.out.wbcs.bam /nfs/kitzman2/jacob/proj/jensplice/20220422_wt1_mpsa_trial4and3_deep/process_star/BB_RT_1_340_335_Cos1053/BB_RT_1_340_335_Cos1053Aligned.out.wbcs.ix.txt /nfs/kitzman2/smithcat/proj/wt1_2022/20220512_accept_vars/JKP1053_BB_RT_1_340_335_Cos1053_acceptor_vars.txt /srv/www/html/pub/public/kitzmanlab/202204_cathy_temp/20220512_accept_vars/BB_RT_1_340_335_Cos1053/ /nfs/kitzman2/jacob/proj/jensplice/20220415_wt1_mpsa_trial3/jkp1053_1054_1055.fa


basefn=check_rna
for status in pass apparently_wt_no_passing_vars possible_chimeric_no_major_variant ; do 
extract_specific_read_groups \
  --tag_field BC \
  --single_bam $1 \
  --single_bcindex $2 \
  --barcode_list <(cat $3 | mlr --tsv  filter "\$status==\"$status\"" then cut -f readgroupid | sed -e1d | sort -u ) \
  --mkigvpage \
  --track_height 400 \
  --web_out_dir $4 \
  --web_out_basefn ${basefn}_${status} \
  --ref_fa $5
done